import streamlit as st
import pandas as pd
from sklearn.preprocessing import MinMaxScaler
import pydeck as pdk
import matplotlib.pyplot as plt
import arabic_reshaper
from bidi.algorithm import get_display

st.set_page_config(
    page_title="Unforgeten trace",
    page_icon="๐",
    layout="wide",
    initial_sidebar_state="expanded"
)

# -------------------------------
# Global CSS for Arabic text and layout
# -------------------------------
st.markdown("""
<style>
body, div, p {
    font-family: 'Tahoma', Arial, sans-serif;
    direction: rtl;
    text-align: right;
}
h3 {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 10px;
}
h4 {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 8px;
}
h5 {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 6px;
}
p, li, div {
    font-size: 16px;
    line-height: 1.7;
}
ul {
    padding-right: 20px;
}
.metadata-card h5 {
    font-size: 16px;
    margin: 2px 0;
}
</style>
""", unsafe_allow_html=True)

# -------------------------------
# Load Data
# -------------------------------
url = "https://raw.githubusercontent.com/Luay-alhammada/Unforgeten_trace/refs/heads/main/under_18_9.csv"

@st.cache_data
def load_data(url):
    return pd.read_csv(url)

df = load_data(url)
df['date_in'] = pd.to_datetime(df['date_in'], errors='coerce')
df["lat"] = pd.to_numeric(df["lat"], errors="coerce")
df["lon"] = pd.to_numeric(df["lon"], errors="coerce")

# -------------------------------
# Page Title
# -------------------------------
st.markdown("<h4 style='text-align: center; direction: rtl;'>ุงูุฃุทูุงู ูู ุณุฌูุงุช ูุฑุน ุชุญููู ุงููุฎุงุจุฑุงุช ุงูุฌููุฉ</h4>", unsafe_allow_html=True)
st.markdown("<br>", unsafe_allow_html=True)

st.markdown("""
<div style='text-align: right; direction: rtl;'>
<h4 style='text-align: right;'>โข <b>ุงูููุถูุน:</b> ุงูุงูุชูุงูุงุช ุจุญู ุงูุฃุทูุงู (ุฏูู ุณู ุงูู 18)</h4>
<h4 style='text-align: right;'>โข <b>ุงููุชุฑุฉ ุงูุฒูููุฉ:</b> 2011 ุญุชู 2016</h4>
<h4 style='text-align: right;'>โข <b>ุงูุนุฏุฏ ุงูุฅุฌูุงูู:</b> 1600 ุณุฌู</h4>
</div>
""", unsafe_allow_html=True)
st.markdown("<br>", unsafe_allow_html=True)

# -------------------------------
# Layout: Filters + Map + Text
# -------------------------------
col1, col2, col4, col3 = st.columns([1, 4, 1, 4])

with col1:
    st.header("Filters")
    years = sorted(df['date_in'].dt.year.dropna().unique().astype(int), reverse=True)
    years_with_all = ['All Years'] + years
    selected_year = st.selectbox("Select Year", years_with_all)

if selected_year == "All Years":
    df_filtered = df.copy()
else:
    df_filtered = df[df['date_in'].dt.year == selected_year]

# -------------------------------
# Map: Birthplaces
# -------------------------------
with col2:
    st.markdown("<h4>1 - ุฃูุงูู ุชููุฏ ุงููุนุชูููู</h4>", unsafe_allow_html=True)
    st.markdown("<div>ุญูุงูู 40% ูู ุงูุงุณูุงุก ุชู ุฐูุฑ ุงูุงูู ุชููุฏูู</div><br>", unsafe_allow_html=True)

    df_counts = df_filtered.groupby("ููุงู ุงูููุงุฏุฉ").size().reset_index(name="count")
    df_coords = df_filtered.groupby("ููุงู ุงูููุงุฏุฉ")[["lat", "lon"]].first().reset_index()
    df_map = df_counts.merge(df_coords, on="ููุงู ุงูููุงุฏุฉ", how="left")
    df_map = df_map.dropna(subset=["lat", "lon"])

    scaler = MinMaxScaler((5, 20))
    df_map["radius"] = scaler.fit_transform(df_map[["count"]])

    layer = pdk.Layer(
        "ScatterplotLayer",
        data=df_map,
        get_position=["lon", "lat"],
        get_radius="radius",
        get_fill_color=[200, 30, 0, 160],
        pickable=True,
        radius_units="pixels",
    )

    view_state = pdk.ViewState(latitude=34.8, longitude=38, zoom=6)
    r = pdk.Deck(
        layers=[layer],
        initial_view_state=view_state,
        tooltip={
            "html": "<b>Birthplace:</b> {ููุงู ุงูููุงุฏุฉ}<br/><b>Cases:</b> {count}",
            "style": {"backgroundColor": "steelblue", "color": "white"}
        },
        map_style="light"
    )
    st.pydeck_chart(r)

# -------------------------------
# Introduction Text
# -------------------------------
with col3:
    st.markdown("<h3>ููุฏูุฉ</h3>", unsafe_allow_html=True)
    st.markdown("""
<div>
ุจุนุฏ ุงูููุงุฑ ุงููุธุงู ุงูุณูุฑู ูู ุงูุซุงูู ูู ุฏูุณูุจุฑ/ูุงููู ุงูุฃูู 2024ุ ุณูุฑูุจุช ูุฌููุนุฉ ูุจูุฑุฉ ูู ุงููุซุงุฆู ุงูุงุณุชุฎุจุงุฑุงุชูุฉ ุงูุญุณุงุณุฉุ ูู ุจูููุง ูุซุงุฆู ุชุนูุฏ ุฅูู ูุฑุน ุงูุชุญููู ูุฅุฏุงุฑุฉ ุงููุฎุงุจุฑุงุช ุงูุฌููุฉ. ูุฐู ุงูููุงุฏ ุฌุงุกุช ุนูู ุดูู ูุณุชูุฏุงุช ูุฌุฏุงูู ุจูุงูุงุช (Excel)ุ ููููุงุช ูุตูุฉ (Word)ุ ูุตูุฑุ ููููุงุช (PDF)ุ ุญูุซ ุฌุฑู ุงุณุชุฎุฑุงุฌ ุงููุนูููุงุช ูู ุงููุซุงุฆู ุงููุตูุฑุฉ ูุฏูุฌูุง ูู ูุงุนุฏุฉ ุจูุงูุงุช ูุชูุงููุฉ.

ุฎุถุนุช ูุฐู ุงูุจูุงูุงุช ูุนูููุงุช ุชูุธูู ูุชุตููู ุฏูููุฉุ ูุน ุงูุชุฃููุฏ ุนูู ุฃู ุงูุชุญูู ูู ุฏูุฉ ูุตุญุฉ ุฌููุน ุงููุนูููุงุช ูู ุนูููุฉ ุฏุงุฆูุฉ ููุณุชูุฑุฉ. ููููุฏูู ูุฐุง ุงูุชูุฑูุฑ ุชุญููููุง ุฎุงุตูุง ุจูุถูุฉ ุงูุฃุทูุงู ุฏูู ุณู ุงูุซุงููุฉ ุนุดุฑุฉุ ููููู ุฌุฒุกูุง ูู ุณูุณูุฉ ุชุญูููุงุช ุณุชููุดุฑ ุชุจุงุนูุง ูุชุชูุงูู ููุถูุนุงุช ูุฎุชููุฉ ูู ูุฐู ุงูุณุฌูุงุช.

ุจูุบ ุฅุฌูุงูู ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุชู ุชู ุจูุงุคูุง ุญูุงูู 100 ุฃูู ุณุทุฑุ ููุซู ูู ุณุทุฑ ููุทุฉ ุจูุงูุงุช ูุณุชููุฉ. ููุฏ ุชู ุชุทุจูู ุชูููุงุช ูุชุนุฏุฏุฉ ูุชุตููุฉ ูุฐู ุงูุจูุงูุงุช ูุงููุตูู ุฅูู ุงููุนูููุงุช ุฐุงุช ุงูุตูุฉ ุจุงูุฃุทูุงู ุงูููุตูุฑ. ูุชุดูุฑ ุงูุจูุงูุงุช ุงูุฃูููุฉ ุฅูู ุฃู 1600 ุทูู ุนูู ุงูุฃูู ูุฏ ูุฑุฏ ุฐูุฑูู ูู ูุฐู ุงูุณุฌูุงุช. ูุฐุง ุงูุฑูู ูุง ููุซู ุงูุนุฏุฏ ุงูุฅุฌูุงููุ ุจู ููุชุตุฑ ุนูู ูุง ุงุณุชุทุนูุง ุฑุตุฏู ูู ุงููุซุงุฆู ุงูุชู ุชุบุทู ุงููุชุฑุฉ ูู 2011 ุฅูู 2016.

 ุชุถููุช ุงูุณุฌูุงุช ุงููุณุฑุจุฉ ุชุตูููุงุช ุฏูููุฉ ูู ุงููุตุฏุฑุ ุดููุช: ุชุงุฑูุฎ ุงูุงุนุชูุงูุ ุชุงุฑูุฎ ุฅุฑุณุงู ุงูุฅุถุจุงุฑุฉุ ุชุงุฑูุฎ ุนูุฏุฉ ุงูุฅุถุจุงุฑุฉุ ุชุงุฑูุฎ ุงูุฅูุฑุงุฌุ ุชุงุฑูุฎ ุงููููุงุฏุ ุชุงุฑูุฎ ุงูููุงุฉุ ุงูุฌุฑูุ ููุชุฑุญ ุงูุนููุฏ ุฑุฆูุณ ุงููุฑุนุ ููุฑุงุฑ ุงูููุงุก.
                
ูู ูุฐุง ุงูุชูุฑูุฑุ ูุจุฏุฃ ุงูุชุญููู ูู ุจูุงูุงุช ููุงู ููุงุฏุฉ ุงููุนุชููููุ ูุฑูุฑูุง ุจุงูุฏูุฑูุงุช ุงูุชู ููุฐุช ุนูููุงุช ุงูุงุนุชูุงู ู ุงููุฑูุน ุงูุฃูููุฉ ุงูุชู ุฌุฑู ุชุณููู ุงููุนุชูููู ุฅูููุง. ููุง ูุชูุงูู ุงููุงุน ุงููุญูููู ูุงูุงูุณุงู ูุงููุฌุงู ุงููุงุนูุฉ ู ูุณุชุนุฑุถ ุงูุชูุฑูุฑ ุฃูุถุง ุทุจูุนุฉ ุงูุชูู ุงูููุฌููุฉ ูููุชูููู ููุง ุงูุชูุช ุฅููู ูุถุงูุงููุ ูููุฎุชุชู ุจุนุฑุถ ุจูุงูู ููุถุญ ุงูุชูุฒุน ุงูุฒููู ูุนุฏุฏ ุงููุนุชูููู ุฎูุงู ุชูู ุงูุณููุงุช ูููุชุทูุงุช ูู ุงูุณุฌู.
</div>
""", unsafe_allow_html=True)
st.markdown("<br>", unsafe_allow_html=True)

# -------------------------------
# Section 2: Arresting Patrols Pie Chart
# -------------------------------
col5, col6, col7, col8 = st.columns([1,4,1,4])

with col8:
    st.markdown("<h4>2- ุฃุณูุงุก ุงูุฏูุฑูุงุช ุงูุชู ูุงูุช ุจุฅุนุชูุงููู</h4>", unsafe_allow_html=True)
    st.markdown("<div>ูุดู ุชุญููู ุงููุซุงุฆู ุงููุณุฑุจุฉ ุนู ูุฌูุฏ ุญูุงูู 50 ุฌูุฉ ูุฎุชููุฉ ุชุชุจุน ูุนุฏุฉ ุฃุฌูุฒุฉ ุฃูููุฉ ูุนุณูุฑูุฉ ูุงูุช ูุณุคููุฉ ุนู ุงุนุชูุงู ูุฌูุจ ุงููุนุชูููู ุฅูู ูุฑุน ุงูุชุญููู ุงูุชุงุจุน ูุฅุฏุงุฑุฉ ุงููุฎุงุจุฑุงุช ุงูุฌููุฉ. ุงูุฑุณู ุงูุจูุงูู ูุธูุฑ ุฃูู ุนุดุฑ ุฏูุฑูุงุช ูุงูุช ุงูุฃูุซุฑ ูุดุงุทูุง.</div>", unsafe_allow_html=True)
    
    pie_counts = df_filtered['ุงูุฏูุฑูุฉ_ุงูุชู_ุฌูุจุชู'].value_counts().head(11)
    pie_counts = pie_counts[pie_counts.index != 'no_value']
    legend_labels = [get_display(arabic_reshaper.reshape(f"{cat}")) for cat in pie_counts.index]

    def autopct_counts(pct, all_vals):
        absolute = int(round(pct/100.*sum(all_vals)))
        return str(absolute)

    fig, ax = plt.subplots(figsize=(3, 3))
    ax.pie(pie_counts.values,
           labels=None,
           autopct=lambda pct: autopct_counts(pct, pie_counts.values),
           startangle=90,
           textprops={'fontsize':6})
    ax.legend(legend_labels, loc="center left", bbox_to_anchor=(1.1, 0.5), fontsize=5, frameon=False)
    ax.axis('equal')
    st.pyplot(fig)

# -------------------------------
# Section 3: Investigators & Departments
# -------------------------------
with col6:
    st.markdown("<h4>3 - ุงููุญูููู ูุงูุงูุณุงู ุฏุงุฎู ุงููุฑุน</h4>", unsafe_allow_html=True)
    st.markdown("""
<div>
<p>ูู ุงููุฑุนุ ุชุธูุฑ ุงูุจูุงูุงุช ูุฌูุฏ ุชุตููููู ูููุญูููู:</p>
<ul>
<li><strong>ุงููุฆุฉ ุงูุฃููู:</strong> ุชุดูู ุงููุญูููู ุงูุฐูู ูู ุชูุฐูุฑ ุฃุณูุงุคููุ ุจู ุฑููุฒ ุชุดูุฑ ุฅูููู (ูุซู: ุซ4ุ ุฒ10ุ ู2). ููุฑุฌุญ ุฃู ูุฐุง ุงูุฅุฌุฑุงุก ููุฏู ุฅูู ุงูุญูุงุธ ุนูู ุณุฑูุชููุ ุฎุงุตุฉ ูู ุธู ุฏูุฑูู ูู ุงูุชุฒุงุน ุงูุงุนุชุฑุงูุงุช ุนุจุฑ ุฃุณุงููุจ ุงูุชุนุฐูุจ.</li>
<li><strong>ุงููุฆุฉ ุงูุซุงููุฉ:</strong> ุชุถู ุงููุญูููู ุงูุฐูู ุฐููุฑุช ุฃุณูุงุคูู ุงูุฃููู ุฃู ุงููุงููุฉ. ูู ุจุนุถ ุงูุญุงูุงุชุ ุฃุดุงุฑุช ุงูุณุฌูุงุช ุฅูู ุงููุณู ุฃู ุงููุฌูุฉ ุงููุณุคููุฉ ุนู ุงูุชุญููู ุจุฏููุง ูู ุงุณู ุงููุญูู. ูู ุชุฌุฑุจุชู ูู ูุฑุน ุงููุฒุฉ ูุงูุช ุฅุฌุฑุงุกุงุช ุงูุชุญููู ุชุจุฏุฃ ุจุงูุถุฑุจ ูุงูุชุนุฐูุจ ูู ุณุงุญุฉ ุงููุฑุน ูุงูุชุฒุงุน ุงูุงุนุชุฑุงูุงุชุ ูุจุนุฏ ุงูุงุนุชุฑุงูุ ูููุช ุฅูู ุบุฑูุฉ ูุญูู ุขุฎุฑ ูุฌูุณ ุฎูู ููุชุจู ุญูุซ ูุนุจ ุฏูุฑ ุงููุญูู ุงููุทูู.</li>
</ul>
<p><strong>ุงูุฑุชุจ ุงูุนุณูุฑูุฉ ุงููุดุงุฑูุฉ ูู ุงูุชุญูููุงุช:</strong></p>
<ul>
<li>ููุฏูุ ูููุจ , ุฑุงุฆุฏุ ููุงุฒูุ ูุณุงุนุฏุ ุนููุฏุ ุนููุฏ.</li>
</ul>
<p><strong>ุงูุฃูุณุงู ูุงููุฌุงู ุงููุงุฑุฏ ุฐูุฑูุง ูู ุงูุณุฌูุงุช :</strong></p>
<ul>
<li>ูุณู ุงูุชูุธููุงุช ูุงูุชูุงุฑุงุช ุงูุชูููุฑูุฉ - ูุณู ุงูุชุญููู ุงูุฌูุงุฆู ูุงูุงูุชุตุงุฏู - ูุณู ุงูุชุญููู ุงูุฃููู ูููุงูุญุฉ ุงูุฅุฑูุงุจ - ูุณู ุงูุชุญููู ุงูุงูุถุจุงุทู ูุงููุณููู.</li>
<li>ุงููุฌูุฉ ุงูุฃููู - ุงููุฌูุฉ ุงูุซุงููุฉ - ูุฌูุฉ ุฃููู + ูุฌูุฉ ุซุงููุฉ - ูุฌูุฉ ุงูููุฏุงู - ูุฌูุฉ ุงูุชุญููู ูุน ุงููุนุงุฏูู.</li>
</ul>
</div>
""", unsafe_allow_html=True)

col9, col10, col11, col12 = st.columns([1,4,1,4])

# Places of Arrest
with col10:
    st.markdown("<h5>5 - ุฃูุงูู ุงูุงุนุชูุงู ูู ุงูุฌููุฉ</h5>", unsafe_allow_html=True)
    st.markdown("""
<div>
ูููุง ูุฎุต ุฃูุงูู ุงูุงุนุชูุงูุ ุฃุธูุฑุช ุงูุจูุงูุงุช ูุง ููุงุฑุจ ุฃุฑุจุนูู ูููุนูุง ููุงุนุชูุงู ุฃู ุงูุงุญุชุฌุงุฒ. 
ููุถุญ ุงูุฑุณู ุงูุจูุงูู ุฃุนูุงู ุฃูุซุฑ 15 ูููุนูุง ูุฑูุฏูุงุ ูุซู <b>ุงููุฒุฉ ุงูุฌุฏูุฏ</b> ู<b>ุงููุฒุฉ ุงููุฏูู</b>. 
ููุง ูุฑุฏุช ูู ุงูุจูุงูุงุช ูุนูููุงุช ูุชูุฑูุฉุ ูุฃุฑูุงู ุฃู ุฃุณูุงุก ุถุจุงุท ูุฃุดุฎุงุตุ ุชุญุชุงุฌ ุฅูู ุจุญุซ ุฅุถุงูู ููุชุฃูุฏ ููุง ุฅุฐุง ูุงูุช ุชุนูุณ ููุงูุน ูุนููุฉ ุฃู ุฃููุง ุฃูุฏุฑุฌุช ุจุทุฑูู ุงูุฎุทุฃ.
</div><br>
""", unsafe_allow_html=True)

    bar_counts = df_filtered['Place of Arrest'].value_counts().head(15).sort_values(ascending=False)
    labels = [get_display(arabic_reshaper.reshape(f"{cat}")) for cat in bar_counts.index]

    fig, ax = plt.subplots(figsize=(14,8))
    bars = ax.bar(labels, bar_counts.values)
    for bar in bars:
        height = bar.get_height()
        ax.text(bar.get_x() + bar.get_width()/2, height + 2, f'{int(height)}', ha='center', va='bottom', fontsize=14)
    ax.tick_params(axis='x', labelsize=16, rotation=45)
    ax.tick_params(axis='y', labelsize=14)
    ax.spines[['top', 'right']].set_visible(False)
    plt.grid(axis='y', color='lightgray', linestyle='--', linewidth=0.5, alpha=0.7)
    plt.tight_layout()
    st.pyplot(fig)

# Charges
with col12:
    st.markdown("<h4>4 - ุงูุชูู ุงูููุฌูุฉ</h4>", unsafe_allow_html=True)
    st.markdown("""
<div>
ุชู ุชุฑุชูุจ ุงูุชูู ูู ุงูุฃูุซุฑ ุชูุฑุงุฑุงู ุฅูู ุงูุฃููุ ุจูุงุกู ุนูู ุงูุจูุงูุงุช ุงููููุฏูุฉ ููุฐุง ุงูุชูู ูุดุชุฑูุฉ ููุงุทูุงู ูุงููุจุงุฑ ุงูุฐูู ุงุนุชููู ูุนูู :

1. <b>ุงููุดุงุฑูุฉ ูู ุงููุธุงูุฑุงุช ูุฃุนูุงู ุงูุดุบุจ:</b> ุชุดูู ุงููุดุงุฑูุฉ ูู ุงููุธุงูุฑุงุชุ ุฃุนูุงู ุงูุดุบุจ ูุงูุชุฎุฑูุจุ ุงูุชุญุฑูุถ ุนูู ุงูุชุธุงูุฑุ ููุงููุฉ ุงูุฏูุฑูุงุชุ ุชุฑุฏูุฏ ุดุนุงุฑุงุช ููุงูุถุฉ ููุฏููุฉุ ูุฑูู ุงูุญุฌุงุฑุฉ ุนูู ููุงุช ุงูุฃูู.
2. <b>ุงูุนุถููุฉ ูู ูุฌููุนุงุช ุฅุฑูุงุจูุฉ ูุณูุญุฉ:</b> ุชุดูู ุงูุงูุถูุงู ุฅูู ุฌูุงุนุงุช ูุณูุญุฉ ูุฎุชููุฉุ ุงููุดุงุฑูุฉ ูู ุนูููุงุช ุฅุฑูุงุจูุฉ ุถุฏ ุงูุฌูุด ูุงูุฃููุ ุฅูุงูุฉ ุญูุงุฌุฒ ุนูู ุงูุทุฑูุงุชุ ูุญูุงุฒุฉ ุฃุณูุญุฉ.
3. <b>ุงูุชุนุงูู ูุน ุงููุณูุญูู:</b> ุชูุฏูู ุงูุฏุนู ุงููุงุฏู ูุงูููุฌุณุชู ูููุณูุญููุ ููู ุงูุฃุณูุญุฉ ูุงูุฐุฎูุฑุฉุ ุชูููุฑ ุงููุฃููุ ูุชูุฏูู ุงููุนูููุงุช.
4. <b>ุงูุชุญุฑูุถ:</b> ูุดูู ุงูุชุญุฑูุถ ุนูู ุงูุชุธุงูุฑุ ุงูุชุญุฑูุถ ุงูุทุงุฆููุ ูุชุญุฑูุถ ุงูุนุณูุฑููู ุนูู ุงูุงูุดูุงู.
5. <b>ุงูุงุดุชุจุงู ุจูุถุนูู ุงูุฃููู:</b> ูุฑุงูุจุฉ ุงูุญูุงุฌุฒ ูุงูููุดุขุช ุงูุญููููุฉุ ุญูุงุฒุฉ ููุงุทุน ูุณูุฆุฉ ุนูู ุงููุงุชูุ ูุนุฏู ุงูุงูุชุซุงู ูุฃูุงูุฑ ุงูุฏูุฑูุฉ.
6. <b>ุงูุชูุงุตู ูุน ุฅุฑูุงุจููู:</b> ุงูุชูุงุตู ูุน ุฃูุฑุงุฏ ูุนุฑูููู ุจุงูุชูุงุฆูู ูุฌูุงุนุงุช ุฅุฑูุงุจูุฉุ ูุชุจุงุฏู ุงููุนูููุงุช ูุนูู.
7. <b>ูุฎุชูู:</b> ุชุดูู ุณุฑูุฉุ ุชุฒููุฑุ ุงูุชุญุงู ุตูุฉ ุฃูููุฉุ ุชุฎุฑูุจ ููุชููุงุช ุนุงูุฉุ ูุญุงููุฉ ูุบุงุฏุฑุฉ ุงูุจูุงุฏ ุจุทุฑููุฉ ุบูุฑ ุดุฑุนูุฉ.
</div>
""", unsafe_allow_html=True)

# -------------------------------
# Section 7 & 6: Referral Paths & Branch Recommendations
# -------------------------------
col14, col15, col16, col17 = st.columns([1,4,1,4])

# Referral Paths
with col15:
    st.markdown("<h4>7 - ูุณุงุฑุงุช ุงูุฅุญุงูุฉ</h4>", unsafe_allow_html=True)
    st.markdown("""
<div>
<p>
ุชูุธูุฑ ุงูุจูุงูุงุช ุฅุญุงูุฉ ุงูุฃุทูุงู ุฅูู ุฌูุงุช ูุชุนุฏุฏุฉ. ุงููุณุจุฉ ุงูุฃูุจุฑ ูู ุงูุฅุญุงูุงุช ูุงูุช ุฅูู ุฅุฎูุงุก ุงูุณุจููุ ุชูููุง ุงูุฅุญุงูุฉ ุฅูู ุงูููุงุจุฉ ุงูุนุงูุฉ ุฃู ุงููุญููุฉ ุงูุนุณูุฑูุฉ ููุญููุฉ ูุถุงูุง ุงูุฅุฑูุงุจ. ููู ุงูููุงุจูุ ูู ููุฐูุฑ ูุณุงุฑ ุงูุฅุญุงูุฉ ููุญู 100 ุญุงูุฉ.
</p>
<p><strong>ุงููุญุงูู ุงูููุฏุงููุฉ:</strong></p>
<p>ูุดูุช ุงูุจูุงูุงุช ุนู ุฅุญุงูุฉ ูุง ููุงุฑุจ 50 ุญุฏุซูุง ุฅูู ุงููุญุงูู ุงูููุฏุงููุฉุ ุญูุซ ูุฑุฏ ุฐูู ุตุฑุงุญุฉู ูู ูุชุงุจ ููุฌู ูู ุฑุฆูุณ ูุฑุน ุงูุชุญููู ุฅูู ูุฏูุฑ ุงูุฅุฏุงุฑุฉ. ูููุธูุฑ ูุญุชูู ุงููุชุงุจ ุงูุชุงูู:
ุงูุชุฑุงุญ ุงูุนููุฏ: "ููุฑุฌู ุจูุงู ูุฑุงุฑ ุณูุงุฏุชูู ุญูู ุฅุญุงูุชููุง ุฅูู ูุญููุฉ ุงูููุฏุงู ุงูุนุณูุฑูุฉ ุจุบุถ ุงููุธุฑ ุนู ุณูู ูููู ุญุฏุซูุง."
ุฌูุงุจ ูุฏูุฑ ุงูุฅุฏุงุฑุฉ: ูุญุงู ุฅูู ูุญููุฉ ุงูููุฏุงู ุจุบุถ ุงููุธุฑ ุนู ุณูู.
</p>
<p><strong>ุงูุชุญูุธ ูููุจุงุฏูุฉ:</strong></p>
<p>ูุดูุช ุงูุนุฏูุฏ ูู ุงูุณุฌูุงุช ุนู ุงูุชุญูุธ ุนูู ุงูุฃุทูุงู ุตุฑุงุญุฉูุ ุฅูุง ููุถุบุท ุนูู ุฐูููู ูุชุณููู ุฃููุณูู ุฃู ูุงุณุชุฎุฏุงููู ูู ููุงูุถุงุช ุงูุชุจุงุฏู. ุฃุธูุฑุช ุงูุณุฌูุงุช ุฃูุถูุง ููุงุฉ ุนุฏุฏ ูู ุงูุฃุทูุงูุ ูุฃูุถุง ุฅูู ุฅุฌุฑุงุก ููุงุจูุงุช ูุน ุตุญู ูุชููุฒูููุงุช ูุญููุฉ ูุนุฑุจูุฉ ูุฏูููุฉ ูุชุนุฒูุฒ ุจุฑูุจุงุบูุฏุง ุงููุธุงู.
ูุชูุดู ุงูุณุฌูุงุช ุฃูุถูุง ุนู ูุฌูุฏ ุฏุนู ูุงูู ูุฅูุชุงุฌ ูููู ูุฑูุฒ ุนูู ุฏูุฑ "ุฃุทูุงู ุงููุชุทุฑููู ุงูุฅุณูุงูููู".
</p>
<br>
<p><strong>ูุญููุฉ ุงูุฃุญุฏุงุซ:</strong></p>
<p>ุจุนุถ ุงูุฃุทูุงู ุชูุช ุฅุญุงูุชูู ุฅูู ูุญููุฉ ุงูุฃุญุฏุงุซ ุฎุตูุตูุง ุจุนุฏ ุตุฏูุฑ ุชุนููู ููุชุจ ุงูุฃูู ุงููุทูู ุฑูู 8/2051 ุชุงุฑูุฎ 2016/6/10 ููุถู ุจุฅุญุงูุฉ ูุงูุฉ ุงูููููููู ุงูุฃุญุฏุงุซ ุฅูู ูุญููุฉ ุงูุฃุญุฏุงุซ ุงููุฎุชุตุฉ ุญูููุง ูููุง ุจูุบุช ุฏุฑุฌุฉ ุงูุฌุฑููุฉ.</p>
""", unsafe_allow_html=True)

# Branch Recommendations
with col17:
    st.markdown("<h4>6 - ููุชุฑุญุงุช ุงูุงุญุงูุฉ ูู ุฑุฆูุณ ุงููุฑุน ููุฏูุฑ ุงูุงุฏุงุฑุฉ</h4>", unsafe_allow_html=True)
    bar_counts = df_filtered['ุงุญุงูุงุช'].value_counts().head(20).sort_values()
    labels = [get_display(arabic_reshaper.reshape(f"{cat}")) for cat in bar_counts.index]

    fig, ax = plt.subplots(figsize=(14,8))
    bars = ax.barh(labels, bar_counts.values)
    for bar in bars:
        width = bar.get_width()
        ax.text(width + 7, bar.get_y() + bar.get_height()/2, f'{int(width)}', va='center', ha='left', fontsize=16)
    ax.tick_params(axis='y', labelsize=18)
    ax.set_xlabel('')
    ax.set_xticks([])
    ax.spines[['top','right','bottom','left']].set_visible(False)
    plt.grid(axis='x', color='lightgray', linestyle='--', linewidth=0.5, alpha=0.7)
    plt.tight_layout()
    st.pyplot(fig)

# -------------------------------
# Section 8 & 9: Yearly Distribution & Record Excerpts
# -------------------------------
col18, col19, col20, col21 = st.columns([1,4,1,4])

# Yearly Distribution
with col19:
    st.markdown("<h3> 9 - ุงูุชูุฒุน ุงูุณููู</h3>", unsafe_allow_html=True)
    counts_monthly = df_filtered.groupby(df_filtered['date_in'].dt.to_period("M")).size()
    counts_monthly.index = counts_monthly.index.to_timestamp()

    fig, ax = plt.subplots(figsize=(16,8))
    ax.plot(counts_monthly.index, counts_monthly.values, marker='o', color='royalblue')
    ax.set_title(f"Number of Records per Month ({selected_year})", fontsize=12)
    ax.set_xlabel("Month", fontsize=10)
    ax.set_ylabel("Count", fontsize=10)
    plt.xticks(rotation=60)
    plt.grid(True)
    st.pyplot(fig)

    st.markdown("""
<div>
ููุธูุฑ ุงููุฎุทุท ุฃุนูุงู ุงูุชูุฒูุน ุงูุฒููู ูุญุงูุงุช ุงูุงุนุชูุงู ุงูููุซูุฉ ุฎูุงู ูุฐู ุงููุชุฑุฉุ ูุน ุฐุฑูุฉ ูู ุดูุฑ <strong>ุฃูุงุฑ 2013</strong>.
</div>
""", unsafe_allow_html=True)

# Record Excerpts
with col21:
    st.markdown("<h3> 8 - ููุชุทูุงุช ูู ุงูุณุฌู</h3>", unsafe_allow_html=True)
    st.markdown("""
<div>
    <li>ุฅุฎูุงุก ุณุจูู ุงููุฐููุฑ ูุฑุจุทู ุจุดูู ุฑุณูู ูุชูุตู ุงุฎุจุงุฑ ุงูุงุทูุงู ุงูููุฏุนูู ูุฏู ุงูุงุฏุงุฑุฉ ูู ูุฑูุฉ ุงูุงุทูุงู sos</li>
    <li>ูุชุงุจ ุงูู ุงููุฒูุฑู ูุญุฌุจ ุงุณูุงุก ุงูุงุทูุงู ุงูููุฏุนูู ูุตุงูุญูุง ูู ูุฑุงูุฒ ุงูุงููุงุก ูุฏูุฑ ุงูุฑุนุงูุฉ</li>
    <li>ููุงุจูู ุชููุฒููููุฉ ูุน ุงูุทูู ุงูููุฌูุฏ ูู ููุฒู ุงููุณุงุนุฏ1 ุน ุช</li>
    <li>ุฅุญุงูุฉ ุงููุฏุนููู ( ููู ููู ) ุงูู ูุญููุฉ ุงูุงุญุฏุงุซ ุจุนุฏ ุฅุฌุฑุงุก ููุงุจูุฉ ุชููุฒููููุฉ ูุนูู ููุดู ุงููุณุงุฆู ุงููุฐุฑุฉ ููุงุฏุฉ ุงูุซูุฑุฉ ุงููุฒุนููุฉ ููุฑุฃู ุงูุนุงู ุงูุฏุงุฎูู ูุงูุฎุงุฑุฌู</li>
    <li>ุฅุฌุงุจุฉ ุงูุงูู ุงููุทูู ูุน ุงูุฑุงู ุจุนุฏู ุงูููุงููุฉ ุนูู ุงููุงุก ูุถุน ุงูุทููุชูู ูุงูููุง ูุง ุชุฒุงูุง ุชุดููุงู ุนุงูู ุฑุงุฏุน ุฌุฏู ููุงูุฏููุง</li>
    <li>ุงูุชุญูุธ ุนูู ุงููุฏุนููู ( ู ู ูุฃุทูุงููุง ุงูุซูุงุซุฉ ) ููุฅุณุชูุงุฏุฉ ูููู ูู ุฅุญุฏู ุนูููุงุช ุงููุจุงุฏูุฉ ูุงูุชูุงูุถ ูุน ูุณูุญู ุงูููุฌุฉ</li>
    <li>ูุฐูุฑุฉ ุนุฑุถ ุจุฎุตูุต ุญููุจ ุงุทูุงู ููุณุชูุฒูุงุช ุงุทูุงู\nุงูููุงููุฉ ุนูู ุตุฑู ุงููุจูุบ ุน/ุท ูุญุงุณุจ ุงูุงุฏุงุฑุฉ</li>
    <li>ูุตู ุงูุญุฏุซ ... ูู ุงููุฌููุนุงุช ุงูุชุงุจุนุฉ ูุงุฏุงุฑุชูุง ูุนุฏู ุชุณูููู ุงู ุณูุงุญ</li>
</div><br>
""", unsafe_allow_html=True)

col22, col23 = st.columns([1,8])

with col23:
    st.markdown("<h3>ุงูุฌูุงุช ุงููุงุฑุฏ ุฐูุฑูุง ูู ุงูุณุฌูุงุช</h3>", unsafe_allow_html=True)
    st.markdown("""
<div>
ุงููุฌูุฉ ุงูุฃูููุฉ ุจุญูุตุ ุฅุฏุงุฑุฉ ุงููุฎุงุจุฑุงุช ุงูุนุงูุฉุ ุดุนุจุฉ ุงูุฃูู ุงูุณูุงุณูุ ูุณู ุงููุฎุงุจุฑุงุช ุงูุฌููุฉ ุจุญูุงูุ ุฅุฏุงุฑุฉ ููุงูุญุฉ ุงููุฎุฏุฑุงุชุ ููุชุจ ุงูุฃูู ุงููุทููุ ูุฒุงุฑุฉ ุงูุนุฏูุ ูุฒุงุฑุฉ ุงูุฏุงุฎููุฉุ ุงูุฅุฏุงุฑุฉ ุงูุณูุงุณูุฉุ ูุฒุงุฑุฉ ุงูุดุคูู ุงูุงุฌุชูุงุนูุฉ ูุงูุนููุ ูุฑุน ุงูููุงู ุงูุฎุงุตุฉุ ูุณู ุงูุนูููุงุช ุงูุฎุงุตุฉุ ูุฑุน ุงูููุทูุฉ ุงูุฌููุจูุฉุ ูุฑุน ุงูููุทูุฉ ุงูุดูุงููุฉุ ูุฑุน ุงูููุทูุฉ ุงููุณุทูุ ูุฑุน ุงูููุทูุฉ ุงูุดุฑููุฉุ ูุณู ูุทุงุน ุงููุฏููุฉุ ูุฑุน ุงููุนูููุงุชุ ูุฑุน ุงูุดุฑุทุฉ ุงูุนุณูุฑูุฉ ุจุฏูุดูุ ูุณู ุญูุงูุ ูุณู ุฅุฏูุจุ ูุณู ุงูุณููุฏุงุกุ ูุชูุจุฉ ุงููุทุงุฑุงุชุ ุงูููุงุช ุงูุนุงููุฉ ุนูู ุงูุฃุฑุถุ ุฅุฏุงุฑุฉ ุงูุงุชุตุงูุงุชุ ูุตุฑู ุณูุฑูุง ุงููุฑูุฒูุ ุงููุฌูุฉ ุงูุฎุงุตุฉ ุจุชุณููุฉ ุฃูุถุงุน ุงููุชูุฑุทูู ุจุงูุฃุญุฏุงุซุ ุงููุฌูุฉ ุงููุดููุฉ ุจุงูุฑูู 1/8/1337ุ ูุฌููุนุฉ ุงูุชูููุฐ ุงูุฎุงุตุฉุ ููุฆุฉ ููุงูุญุฉ ุบุณูู ุงูุฃููุงู ูุชูููู ุงูุฅุฑูุงุจุ ุงูุฏููุงู ุงูุฎุงุตุ ุงูุฃุตุฏูุงุก (ุฅุดุงุฑุฉ ุบุงูุถุฉ)ุ ููุชุจ ุงูุฃูู ุจุงููุฑูุฉ ุงูุฑุงุจุนุฉุ ุฅุฏุงุฑุฉ ุงููุฌุฑุฉ ูุงูุฌูุงุฒุงุชุ ุงููุฑุน ุงููููุ ูุณู ุงูุชูุธููุงุชุ ุงููุญุฏุฉ 17ุ ูุญููุฉ ุงูููุฏุงู ุงูุนุณูุฑูุฉุ ุงูููุงุจุฉ ุงูุนุงูุฉ ุงูุนุณูุฑูุฉุ ูุญููุฉ ูุถุงูุง ุงูุฅุฑูุงุจุ ุงููุถุงุก ุงููุฎุชุตุ ููุงุฆุญ ุงููุทููุจููุ ุงููุญุงูู ุงูุนุงู ุงูุฃููุ ุงููุถุงุก ุงูุนุณูุฑูุ ุฅุฏุงุฑุฉ ุงูุณุฌูุงุช ุงูุนุณูุฑูุฉุ ูุญุงูุธุฉ ุฑูู ุฏูุดูุ ูุญููุฉ ุงูุฃุญุฏุงุซุ ูุฑุน ุงูุฃูู ุงูุฌูุงุฆูุ ุงูุดุฑุทุฉ ุงูุนุณูุฑูุฉุ ูุฒูุฑ ุงูุฏูุงุนุ ุฅุฏุงุฑุฉ ุดุคูู ุงูุถุจุงุทุ ูุฑุน ุงูุชุญูููุ ูุณู ุงูุณุงุญููุฉุ ุงูุณูุฏ ุงูููุงุก ูุงุฆุฏ ุงูููู ุงูุฌููุฉุ ุงููุณุชุดุงุฑุ ูุชุงุฆุจ ุงูุจุนุซุ ูุดูู ุงูุนุจุงุณูููุ ูุดูู ุฃููุ ุดุนุจุฉ ุงููุฎุงุจุฑุงุชุ ููุชุจ ุฃูู ุงููุตุฑุ ูุฌููุนุฉ ุงูุตููุฑุ ุงูุฃุฌูุฒุฉ ุงูุฃูููุฉุ ุงูุฎุฏูุงุช ุงูุทุจูุฉุ ูุฒูุฑ ุงููุงููุฉุ ุฅุฏุงุฑุฉ ุงูุฃูู ุงูุฌูุงุฆูุ ุณุฌู ุตูุฏูุงูุงุ ููุฆุฉ ุงูุฃุฑูุงูุ ุงููุฑูุฉ ุงูุฑุงุจุนุฉ ุฏุจุงุจุงุชุ ูุฒุงุฑุฉ ุงูุฏุงุฎููุฉ (ููุชุจ ุงููุฒูุฑ)ุ ุญุงูู ูุตุฑู ุณูุฑูุง ุงููุฑูุฒูุ ูุฒูุฑุฉ ุงูุดุคูู ุงูุงุฌุชูุงุนูุฉ ูุงูุนููุ ูุณู ุฏููุงู ุงูุฅุฏุงุฑุฉุ ุงูุฃูู ุงูุฏุงุฎููุ ููุงุฉ ุงูููุงุฑ.
</div><br>
""", unsafe_allow_html=True)

# ==============================================================================
share_url = "https://dashpy-kzz3gq4nig3bwsxbj4k2yh.streamlit.app/"  # ๐ ุถุน ุฑุงุจุท ุชุทุจููู ุจุนุฏ ุงููุดุฑ

st.markdown("<hr>", unsafe_allow_html=True)
st.markdown("""
<div style="text-align:center;">
    <p style="font-size:16px; font-weight:bold;">๐ข ุดุงุฑู ุงูุชูุฑูุฑ:</p>
    <a href="https://www.facebook.com/sharer/sharer.php?u={0}" target="_blank">
        <img src="https://www.svgrepo.com/show/452196/facebook-1.svg" width="40" style="margin:10px;">
    </a>
    <a href="https://www.linkedin.com/shareArticle?mini=true&url={0}&title=Unforgeten%20Trace%20Report&summary=Children%20in%20Airforce%20Intelligence%20Records" target="_blank">
        <img src="https://www.svgrepo.com/show/448234/linkedin.svg" width="40" style="margin:10px;">
    </a>
</div>
""".format(share_url), unsafe_allow_html=True)


# -------------------------------
# Footer
# -------------------------------
st.markdown("<hr>", unsafe_allow_html=True)

st.markdown("""
<p style='text-align:center;font-size:14px;color:gray;'>
ุชูุฑูุฑ ุฅุญุตุงุฆู ูู ุณุฌูุงุช ูุฑุน ุงูุชุญููู ูุงููุฎุงุจุฑุงุช ุงูุฌููุฉ ุญูู ุงูุฃุทูุงู <b>Unforgeten Trace</b> 2025
</p>
<p style='text-align:center;font-size:14px;color:gray;'>โข <b>ุฅุนุฏุงุฏ:</b> ูุคู ุงูุญูุงุฏุฉ</p>
<p style='text-align:center;font-size:14px;color:gray;'>โข <b>ููุชูุงุตู:</b> alhammada.luay@gmail.com</p>
""", unsafe_allow_html=True)


